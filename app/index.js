/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./main.js":
/*!*****************!*\
  !*** ./main.js ***!
  \*****************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _scripts_core_toolbox_manager_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./scripts/core/toolbox/manager.js */ \"./scripts/core/toolbox/manager.js\");\n/* harmony import */ var _scripts_core_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./scripts/core/canvas/layer/manager.js */ \"./scripts/core/canvas/layer/manager.js\");\n/* harmony import */ var _scripts_core_app_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./scripts/core/app.js */ \"./scripts/core/app.js\");\n/* harmony import */ var _scripts_core_memory_database_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./scripts/core/memory/database.js */ \"./scripts/core/memory/database.js\");\n/* harmony import */ var _scripts_core_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./scripts/core/canvas/canvas.js */ \"./scripts/core/canvas/canvas.js\");\n/* harmony import */ var _scripts_core_projects_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./scripts/core/projects.js */ \"./scripts/core/projects.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_scripts_core_toolbox_manager_js__WEBPACK_IMPORTED_MODULE_0__, _scripts_core_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_1__, _scripts_core_app_js__WEBPACK_IMPORTED_MODULE_2__, _scripts_core_memory_database_js__WEBPACK_IMPORTED_MODULE_3__, _scripts_core_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_4__, _scripts_core_projects_js__WEBPACK_IMPORTED_MODULE_5__]);\n([_scripts_core_toolbox_manager_js__WEBPACK_IMPORTED_MODULE_0__, _scripts_core_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_1__, _scripts_core_app_js__WEBPACK_IMPORTED_MODULE_2__, _scripts_core_memory_database_js__WEBPACK_IMPORTED_MODULE_3__, _scripts_core_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_4__, _scripts_core_projects_js__WEBPACK_IMPORTED_MODULE_5__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nif (\"serviceWorker\" in navigator) {\r\n    window.addEventListener(\"load\", function () {\r\n        navigator.serviceWorker.register(\"service-worker.js\").then(function (registration) {\r\n            console.log(\"ServiceWorker registration successful with scope: \", registration.scope);\r\n        }, function (err) {\r\n            console.log(\"ServiceWorker registration failed: \", err);\r\n        });\r\n    });\r\n}\r\n\r\n\r\nCanvasRenderingContext2D.prototype.circle = function (x, y, color = 'yellow', text = '', radius = 2) {\r\n    this.save()\r\n    const c = new Path2D();\r\n    this.fillStyle = color;\r\n    c.arc(x, y, radius, 0, Math.PI * 2);\r\n    this.fill(c);\r\n    this.fillText(text, x, y - 10);\r\n    this.restore();\r\n}\r\nCanvasRenderingContext2D.prototype.line = function (points, color = 'blue', radius = 4) {\r\n    this.save()\r\n    const c = new Path2D();\r\n    this.strokeStyle = color;\r\n    points.forEach(({ x, y }, i) => {\r\n        if (i) {\r\n            c.lineTo(x, y);\r\n        } else {\r\n            c.moveTo(x, y);\r\n        }\r\n    });\r\n    this.stroke(c);\r\n    this.restore();\r\n}\r\nCanvasRenderingContext2D.prototype.mark = function (x, y, text, color = 'yellow', radius = 4) {\r\n    this.save()\r\n    this.fillStyle = color;\r\n    this.fillRect(x - radius / 2, y - radius / 2, radius, radius)\r\n    this.fillText(text, x, y);\r\n    this.restore();\r\n}\r\n\r\n// Prevent right-click context menu\r\n// window.addEventListener(\"contextmenu\", (e) => {\r\n//     e.preventDefault();\r\n// }, false);\r\n\r\n\r\nawait _scripts_core_projects_js__WEBPACK_IMPORTED_MODULE_5__.project.init();\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } }, 1);\n\n//# sourceURL=webpack://quanvas/./main.js?\n}");

/***/ }),

/***/ "./node_modules/uuid/dist/native.js":
/*!******************************************!*\
  !*** ./node_modules/uuid/dist/native.js ***!
  \******************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({ randomUUID });\n\n\n//# sourceURL=webpack://quanvas/./node_modules/uuid/dist/native.js?\n}");

/***/ }),

/***/ "./node_modules/uuid/dist/regex.js":
/*!*****************************************!*\
  !*** ./node_modules/uuid/dist/regex.js ***!
  \*****************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i);\n\n\n//# sourceURL=webpack://quanvas/./node_modules/uuid/dist/regex.js?\n}");

/***/ }),

/***/ "./node_modules/uuid/dist/rng.js":
/*!***************************************!*\
  !*** ./node_modules/uuid/dist/rng.js ***!
  \***************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ rng)\n/* harmony export */ });\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nfunction rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n\n\n//# sourceURL=webpack://quanvas/./node_modules/uuid/dist/rng.js?\n}");

/***/ }),

/***/ "./node_modules/uuid/dist/stringify.js":
/*!*********************************************!*\
  !*** ./node_modules/uuid/dist/stringify.js ***!
  \*********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   unsafeStringify: () => (/* binding */ unsafeStringify)\n/* harmony export */ });\n/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validate.js */ \"./node_modules/uuid/dist/validate.js\");\n\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nfunction unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!(0,_validate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (stringify);\n\n\n//# sourceURL=webpack://quanvas/./node_modules/uuid/dist/stringify.js?\n}");

/***/ }),

/***/ "./node_modules/uuid/dist/v4.js":
/*!**************************************!*\
  !*** ./node_modules/uuid/dist/v4.js ***!
  \**************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _native_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./native.js */ \"./node_modules/uuid/dist/native.js\");\n/* harmony import */ var _rng_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./rng.js */ \"./node_modules/uuid/dist/rng.js\");\n/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./stringify.js */ \"./node_modules/uuid/dist/stringify.js\");\n\n\n\nfunction _v4(options, buf, offset) {\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? (0,_rng_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return (0,_stringify_js__WEBPACK_IMPORTED_MODULE_2__.unsafeStringify)(rnds);\n}\nfunction v4(options, buf, offset) {\n    if (_native_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].randomUUID && !buf && !options) {\n        return _native_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].randomUUID();\n    }\n    return _v4(options, buf, offset);\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (v4);\n\n\n//# sourceURL=webpack://quanvas/./node_modules/uuid/dist/v4.js?\n}");

/***/ }),

/***/ "./node_modules/uuid/dist/validate.js":
/*!********************************************!*\
  !*** ./node_modules/uuid/dist/validate.js ***!
  \********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _regex_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./regex.js */ \"./node_modules/uuid/dist/regex.js\");\n\nfunction validate(uuid) {\n    return typeof uuid === 'string' && _regex_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].test(uuid);\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (validate);\n\n\n//# sourceURL=webpack://quanvas/./node_modules/uuid/dist/validate.js?\n}");

/***/ }),

/***/ "./scripts/core/app.js":
/*!*****************************!*\
  !*** ./scripts/core/app.js ***!
  \*****************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/constants.js */ \"./scripts/shared/constants.js\");\n/* harmony import */ var _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../shared/domElem.js */ \"./scripts/shared/domElem.js\");\n/* harmony import */ var _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./canvas/canvas.js */ \"./scripts/core/canvas/canvas.js\");\n/* harmony import */ var _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./canvas/layer/manager.js */ \"./scripts/core/canvas/layer/manager.js\");\n/* harmony import */ var _memory_database_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./memory/database.js */ \"./scripts/core/memory/database.js\");\n/* harmony import */ var _memory_history_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./memory/history.js */ \"./scripts/core/memory/history.js\");\n/* harmony import */ var _projects_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./projects.js */ \"./scripts/core/projects.js\");\n/* harmony import */ var _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./toolbox/manager.js */ \"./scripts/core/toolbox/manager.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__, _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_3__, _memory_database_js__WEBPACK_IMPORTED_MODULE_4__, _memory_history_js__WEBPACK_IMPORTED_MODULE_5__, _projects_js__WEBPACK_IMPORTED_MODULE_6__, _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__]);\n([_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__, _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_3__, _memory_database_js__WEBPACK_IMPORTED_MODULE_4__, _memory_history_js__WEBPACK_IMPORTED_MODULE_5__, _projects_js__WEBPACK_IMPORTED_MODULE_6__, _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst stateMenuElem = document.getElementById('state');\r\n\r\nclass APPManager {\r\n    constructor() {\r\n        this.state = {\r\n            erase: false,\r\n            fillrule: 'evenodd',\r\n            clip: false,\r\n            fill: false\r\n        }\r\n\r\n        this.transform = {\r\n            scale: 1,\r\n            rotation: 0,\r\n            translateX: 0,\r\n            translateY: 0\r\n        }\r\n\r\n        this.isDragging = false;\r\n        this.lastMousePos = { x: 0, y: 0 };\r\n        this.isSpacePressed = false;\r\n        this.isDirty = false;\r\n        this.unloading = true;\r\n\r\n        this.keybinding = new Map();\r\n\r\n        this.#addEventListener();\r\n        this.#addCanvasEventListeners();\r\n        this.#addTransformControlListeners();\r\n        setTimeout(async () => {\r\n            await this.#save();\r\n        }, 5000);\r\n    }\r\n\r\n    async init() {\r\n        const defaultKeyBind = {\r\n            'p': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('P-pen'),\r\n            'shift+p': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('P-chalk'),\r\n            'r': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('R-rectangle'),\r\n            'shift+r': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('R-roundrectangle'),\r\n            'c': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('C-circle'),\r\n            'shift+c': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('C-ellipse'),\r\n            'l': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('L-line'),\r\n            'shift+l': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('L-arcto'),\r\n            'k': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('K-quadratic'),\r\n            'shift+k': () => _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('K-bezier'),\r\n            'e': () => this.toggleState('erase'),\r\n            'f': () => this.toggleState('fill'),\r\n            'ctrl+shift+c': () => this.toggleState('clip'),\r\n            'escape': () => _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__.canvas.releasePath(),\r\n            'ctrl+0': () => this.resetView(),\r\n            'ctrl+1': () => this.fitToScreen(),\r\n            'ctrl+=': () => this.zoom(1.25),\r\n            'ctrl+-': () => this.zoom(0.8),\r\n            'ctrl+s': async () => await this.#save(true),\r\n            'ctrl+z': async () => {\r\n                await _memory_history_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].undo();\r\n                // console.log('History');\r\n                // console.table(history.history);\r\n                // console.log('Redo');\r\n                // console.table(history.redoStack);\r\n            },\r\n            'ctrl+shift+z': async () => {\r\n                await _memory_history_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].redo();\r\n                // console.log('History');\r\n                // console.table(history.history);\r\n                // console.log('Redo');\r\n                // console.table(history.redoStack);\r\n            }\r\n        }\r\n\r\n        Object.entries(defaultKeyBind).forEach(([id, cb]) => {\r\n            this.addKeyBind(id, cb);\r\n        })\r\n\r\n        _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].selectTool('P-pen');\r\n\r\n        const projectId = _memory_database_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].getCurrentProjectID();\r\n        if (!projectId) return;\r\n        const projectData = await _memory_database_js__WEBPACK_IMPORTED_MODULE_4__.dbOperations.getProject(projectId);\r\n        if (!projectData) {\r\n            await _memory_database_js__WEBPACK_IMPORTED_MODULE_4__.dbOperations.deleteProject(projectId);\r\n            return\r\n        };\r\n\r\n        _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].project = projectData;\r\n        _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width = projectData.width;\r\n        _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height = projectData.height;\r\n\r\n        const layers = (await _memory_database_js__WEBPACK_IMPORTED_MODULE_4__.dbOperations.getLayersByProject(projectId)).sort((a, b) => a.order - b.order);\r\n\r\n        await layers?.forEach(async (layer) => {\r\n            await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLayer({ id: layer.id, name: layer.name, order: layer.order, skipHistory: true });\r\n        });\r\n\r\n        if (_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].layers.size === 0) {\r\n            await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLayer({ skipHistory: true });\r\n        }\r\n\r\n        const box = _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootControllerElem.getBoundingClientRect();\r\n\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootElem.style.width = `${_shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width}px`;\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootElem.style.height = `${_shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height}px`;\r\n\r\n        // Calculate initial fit-to-screen scale\r\n        const scaleX = box.width / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width;\r\n        const scaleY = box.height / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height;\r\n        const fitScale = Math.min(scaleX, scaleY);\r\n\r\n        if (fitScale < 1) {\r\n            this.transform.scale = fitScale;\r\n            this.transform.translateX = (box.width - _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width * fitScale) / 2;\r\n            this.transform.translateY = (box.height - _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height * fitScale) / 2;\r\n        } else {\r\n            this.transform.translateX = (box.width - _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width) / 2;\r\n            this.transform.translateY = (box.height - _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height) / 2;\r\n        }\r\n\r\n        this.#updateTransform();\r\n\r\n        _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__.canvas.reset();\r\n    }\r\n\r\n\r\n    async #save(notify = false) {\r\n        if (!this.isDirty) return;\r\n        _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__.canvas.saveOffScreen();\r\n        const thumbnail = await _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createPreviewCanvas(_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__.canvas.offScreenCanvas)\r\n        const projectId = _memory_database_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].getCurrentProjectID();\r\n        if (!projectId) return;\r\n        _memory_database_js__WEBPACK_IMPORTED_MODULE_4__.dbOperations.updateProject(projectId, { thumbnail });\r\n\r\n        if (notify) {\r\n            const saveNotification = document.getElementById('saveNotification');\r\n            saveNotification.classList.add('show');\r\n            setTimeout(() => {\r\n                saveNotification.classList.remove('show');\r\n            }, 2000);\r\n        }\r\n        this.isDirty = false;\r\n    }\r\n\r\n\r\n    #addEventListener() {\r\n        stateMenuElem.addEventListener('click', e => {\r\n            const elem = e.target;\r\n            this.toggleState(elem.id);\r\n        })\r\n\r\n        addEventListener('keydown', (e) => {\r\n            const el = e.target;\r\n            if (\r\n                el.tagName === 'INPUT' ||\r\n                el.tagName === 'TEXTAREA' ||\r\n                el.isContentEditable\r\n            ) {\r\n                return;\r\n            }\r\n\r\n            e.preventDefault();\r\n            let keyBind = '';\r\n\r\n            if (e.ctrlKey) keyBind += 'ctrl+';\r\n            if (e.shiftKey) keyBind += 'shift+';\r\n            if (e.altKey) keyBind += 'alt+'\r\n            keyBind += e.key;\r\n\r\n            if (keyBind === ' ') {\r\n                this.isSpacePressed = true;\r\n                return;\r\n            }\r\n\r\n            this.keybinding.get(keyBind.toLowerCase())?.();\r\n        })\r\n\r\n        addEventListener('keyup', (e) => {\r\n            e.preventDefault();\r\n            if (e.code === 'Space') {\r\n                this.isSpacePressed = false;\r\n            }\r\n        })\r\n\r\n        // addEventListener(\"beforeunload\", (e) => {\r\n        //     if (!this.isDirty) return;\r\n        //     this.#save();\r\n        //     e.preventDefault();\r\n        // });\r\n\r\n        addEventListener(\"visibilitychange\", () => {\r\n            if (document.visibilityState === \"hidden\") {\r\n                this.#save();\r\n            }\r\n        });\r\n\r\n        addEventListener(\"pagehide\", () => this.#save());\r\n\r\n    }\r\n\r\n    addKeyBind(id, cb) {\r\n        this.keybinding.set(id, cb);\r\n    }\r\n\r\n\r\n    toggleState(id) {\r\n        _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_2__.canvas.releasePath();\r\n        let elem = stateMenuElem.querySelector(`#${id}`);\r\n        if (!_shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.TOOL_IDS.includes(id) && this.state[id] === undefined) return;\r\n\r\n        switch (id) {\r\n            case 'fillrule':\r\n                this.state[id] = this.state[id] === 'nonzero' ? 'evenodd' : 'nonzero';\r\n                if (this.state[id] === 'evenodd') elem.classList.add('selected');\r\n                else elem.classList.remove('selected');\r\n                break;\r\n\r\n            case 'fill':\r\n                this.state[id] = !this.state[id];\r\n                elem.src = this.state[id] === true ? './images/tools/fill.svg' : './images/tools/stroke.svg';\r\n                break;\r\n\r\n            default:\r\n                this.state[id] = !this.state[id];\r\n                if (this.state[id]) elem.classList.add('selected');\r\n                else elem.classList.remove('selected');\r\n                break;\r\n        }\r\n    }\r\n\r\n    // Transform utility methods\r\n    #updateTransform() {\r\n        const { scale, translateX, translateY } = this.transform;\r\n        const transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootElem.style.transform = transform;\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootElem.style.transformOrigin = '0 0';\r\n\r\n        _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.scale = scale;\r\n        // Update info display\r\n        this.#updateTransformInfo();\r\n    }\r\n\r\n    #updateTransformInfo() {\r\n        const scaleInfo = document.getElementById('scaleInfo');\r\n        const rotationInfo = document.getElementById('rotationInfo');\r\n\r\n        if (scaleInfo) {\r\n            scaleInfo.textContent = `${Math.round(this.transform.scale * 100)}%`;\r\n        }\r\n        if (rotationInfo) {\r\n            rotationInfo.textContent = `${Math.round(this.transform.rotation)}Â°`;\r\n        }\r\n    }\r\n\r\n    #addTransformControlListeners() {\r\n        // Button controls\r\n        document.getElementById('resetView')?.addEventListener('click', () => this.resetView());\r\n        document.getElementById('fitToScreen')?.addEventListener('click', () => this.fitToScreen());\r\n        document.getElementById('zoomIn')?.addEventListener('click', () => this.zoom(1.25));\r\n        document.getElementById('zoomOut')?.addEventListener('click', () => this.zoom(0.8));\r\n    }\r\n\r\n    #addCanvasEventListeners() {\r\n        const controller = _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootControllerElem;\r\n\r\n        // Mouse wheel zoom\r\n        controller.addEventListener('wheel', (e) => {\r\n            e.preventDefault();\r\n            const dx = e.deltaX;\r\n            const dy = e.deltaY;\r\n\r\n            if (e.ctrlKey) {\r\n                const rect = controller.getBoundingClientRect();\r\n                const centerX = rect.width / 2;\r\n                const centerY = rect.height / 2;\r\n\r\n                const zoomFactor = dy > 0 ? 0.9 : 1.1;\r\n                this.zoomAtPoint(centerX, centerY, zoomFactor);\r\n            } else {\r\n                this.transform.translateX -= dx;\r\n                this.transform.translateY -= dy;\r\n            }\r\n\r\n            this.#updateTransform();\r\n        });\r\n\r\n        controller.addEventListener('mousedown', (e) => {\r\n            if (this.isSpacePressed || e.button === 1) {\r\n                this.isDragging = true;\r\n                this.lastMousePos = { x: e.clientX, y: e.clientY };\r\n                controller.style.cursor = 'grabbing';\r\n                e.preventDefault();\r\n            }\r\n        });\r\n\r\n        controller.addEventListener('mousemove', (e) => {\r\n            if (this.isDragging) {\r\n                const deltaX = e.clientX - this.lastMousePos.x;\r\n                const deltaY = e.clientY - this.lastMousePos.y;\r\n\r\n                this.transform.translateX += deltaX;\r\n                this.transform.translateY += deltaY;\r\n\r\n                this.#updateTransform();\r\n\r\n                this.lastMousePos = { x: e.clientX, y: e.clientY };\r\n                e.preventDefault();\r\n            } else if (this.isSpacePressed) {\r\n                controller.style.cursor = 'grab';\r\n            } else {\r\n                controller.style.cursor = 'default';\r\n            }\r\n        });\r\n\r\n        controller.addEventListener('mouseup', () => {\r\n            if (this.isDragging) {\r\n                this.isDragging = false;\r\n                controller.style.cursor = this.isSpacePressed ? 'grab' : 'default';\r\n            }\r\n        });\r\n\r\n        controller.addEventListener('mouseleave', () => {\r\n            this.isDragging = false;\r\n            controller.style.cursor = 'default';\r\n        });\r\n    }\r\n\r\n    // Transform control methods\r\n    zoom(factor) {\r\n        const rect = _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootControllerElem.getBoundingClientRect();\r\n        const centerX = rect.width / 2;\r\n        const centerY = rect.height / 2;\r\n        this.zoomAtPoint(centerX, centerY, factor);\r\n    }\r\n\r\n    zoomAtPoint(x, y, factor) {\r\n        const oldScale = this.transform.scale;\r\n        this.transform.scale *= factor;\r\n\r\n        // Limit zoom range\r\n        this.transform.scale = Math.max(0.1, Math.min(10, this.transform.scale));\r\n\r\n        const scaleChange = this.transform.scale / oldScale;\r\n\r\n        // Adjust translation to zoom toward the point\r\n        this.transform.translateX = x - (x - this.transform.translateX) * scaleChange;\r\n        this.transform.translateY = y - (y - this.transform.translateY) * scaleChange;\r\n\r\n        this.#updateTransform();\r\n    }\r\n\r\n    resetView() {\r\n        this.transform = {\r\n            scale: 1,\r\n            rotation: 0,\r\n            translateX: 0,\r\n            translateY: 0\r\n        };\r\n        this.#updateTransform();\r\n    }\r\n\r\n    fitToScreen() {\r\n        const box = _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootControllerElem.getBoundingClientRect();\r\n        const scaleX = box.width / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width;\r\n        const scaleY = box.height / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height;\r\n        const fitScale = Math.min(scaleX, scaleY);\r\n\r\n        this.transform = {\r\n            scale: fitScale,\r\n            rotation: 0,\r\n            translateX: (box.width - _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width * fitScale) / 2,\r\n            translateY: (box.height - _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height * fitScale) / 2\r\n        };\r\n        this.#updateTransform();\r\n    }\r\n}\r\n\r\nconst app = new APPManager();\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (app);\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });\n\n//# sourceURL=webpack://quanvas/./scripts/core/app.js?\n}");

/***/ }),

/***/ "./scripts/core/canvas/canvas.js":
/*!***************************************!*\
  !*** ./scripts/core/canvas/canvas.js ***!
  \***************************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   canvas: () => (/* binding */ canvas),\n/* harmony export */   \"default\": () => (/* binding */ Canvas)\n/* harmony export */ });\n/* harmony import */ var _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../shared/constants.js */ \"./scripts/shared/constants.js\");\n/* harmony import */ var _utils_random_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/random.js */ \"./scripts/utils/random.js\");\n/* harmony import */ var _utils_vector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../utils/vector.js */ \"./scripts/utils/vector.js\");\n/* harmony import */ var _app_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../app.js */ \"./scripts/core/app.js\");\n/* harmony import */ var _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../toolbox/manager.js */ \"./scripts/core/toolbox/manager.js\");\n/* harmony import */ var _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./layer/manager.js */ \"./scripts/core/canvas/layer/manager.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_app_js__WEBPACK_IMPORTED_MODULE_3__, _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_4__, _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__]);\n([_app_js__WEBPACK_IMPORTED_MODULE_3__, _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_4__, _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass Canvas {\r\n    constructor() {\r\n        this.previousPosition = { x: 0, y: 0 };\r\n        this.initialPosition = { x: 0, y: 0 };\r\n\r\n        this.canvas = document.getElementById('canvas');\r\n        this.offScreenCanvas = new OffscreenCanvas(_shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width, _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height);\r\n\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.offScreenCtx = this.offScreenCanvas.getContext('2d');\r\n\r\n        this.canvas.width = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width;\r\n        this.canvas.height = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height;\r\n\r\n        this.path = null;\r\n\r\n        this.isDrawing = false;\r\n        this.flush = true;\r\n        this.points = [];\r\n        this.pointsCount = 0;\r\n        this.state = _app_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].state;\r\n        this.activeTool = null;\r\n        this.layer = null;\r\n\r\n        this.#addEventlistener();\r\n    }\r\n\r\n    createPath() {\r\n        this.path = new Path2D();\r\n    }\r\n\r\n\r\n    #addEventlistener() {\r\n        this.canvas.addEventListener('mousedown', (e) => {\r\n            if (!['L', 'K'].includes(this.activeTool[0]))\r\n                this.#flushDrawing();\r\n            this.createPath();\r\n            const rect = this.canvas.getBoundingClientRect();\r\n            const x = (e.clientX - rect.left) / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.scale;\r\n            const y = (e.clientY - rect.top) / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.scale;\r\n\r\n            this.initialPosition.x = x;\r\n            this.initialPosition.y = y;\r\n            this.previousPosition.x = x;\r\n            this.previousPosition.y = y;\r\n\r\n            this.isDrawing = true;\r\n        });\r\n\r\n        this.canvas.addEventListener('mousemove', (e) => {\r\n            if (this.isDrawing) {\r\n                const rect = this.canvas.getBoundingClientRect();\r\n\r\n                const x = (e.clientX - rect.left) / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.scale;\r\n                const y = (e.clientY - rect.top) / _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.scale;\r\n\r\n                this.draw(x, y);\r\n\r\n                this.previousPosition.x = x;\r\n                this.previousPosition.y = y;\r\n            }\r\n        });\r\n\r\n        this.canvas.addEventListener('mouseup', () => this.#flushDrawing());\r\n        // this.canvas.addEventListener('mouseleave', () => this.#flushDrawing());\r\n    }\r\n\r\n    reset() {\r\n        this.#clear();\r\n        this.isDrawing = false;\r\n        this.path = null;\r\n        this.points = [];\r\n        this.pointsCount = 0;\r\n    }\r\n\r\n    #flushDrawing(flush) {\r\n        console.log('flushing drawing');\r\n        if (this.path === null) return;\r\n\r\n        this.draw(this.previousPosition.x, this.previousPosition.y);\r\n        this.pointsCount++;\r\n\r\n        if (['K', 'L'].includes(this.activeTool[0]) && this.flush && !flush) {\r\n            this.points.push({ x: this.previousPosition.x, y: this.previousPosition.y });\r\n            this.#createCurve();\r\n            this.flush = false;\r\n        }\r\n\r\n        if (flush !== undefined) this.flush = flush;\r\n\r\n        if (this.flush) {\r\n            if (['R', 'C'].includes(this.activeTool[0])) this.points.push({ x: this.previousPosition.x, y: this.previousPosition.y });\r\n\r\n            _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveDrawing(this.path, this.points, this.state);\r\n\r\n            this.reset()\r\n        }\r\n\r\n        this.flush = true;\r\n    }\r\n\r\n    flushToPath(data) {\r\n        const { points, type, layerId, state } = data;\r\n\r\n        this.createPath();\r\n        for (let i = 0; i < points.length; i++) {\r\n            if (i == 0) {\r\n                this.initialPosition.x = points[0].x;\r\n                this.initialPosition.y = points[0].y;\r\n            }\r\n\r\n            this.previousPosition.x = points[Math.max(0, i - 1)].x;\r\n            this.previousPosition.y = points[Math.max(0, i - 1)].y;\r\n            this.points.push({ x: points[i].x, y: points[i].y });\r\n            this.draw(points[i].x, points[i].y, state, type, _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].getLayer(layerId));\r\n        }\r\n\r\n        _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveDrawingIn(layerId, this.path, points, state);\r\n        this.reset();\r\n    }\r\n\r\n    releasePath() {\r\n        if (this.activeTool === null) this.activeTool = _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].activeToolId;\r\n        if ((['L',].includes(this.activeTool[0]) && this.points.length < 2) || (['P', 'K'].includes(this.activeTool[0]) && this.points.length < 3)) return this.reset();\r\n        this.#flushDrawing(true);\r\n    }\r\n\r\n    #clear() {\r\n        this.canvas.width = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width;\r\n        this.canvas.height = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height;\r\n    }\r\n\r\n    #clearOffScreen() {\r\n        this.offScreenCanvas.width = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width;\r\n        this.offScreenCanvas.height = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height;\r\n    }\r\n\r\n    saveOffScreen() {\r\n        this.#clearOffScreen();\r\n\r\n        _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].layers.forEach(layer => {\r\n            this.offScreenCtx.drawImage(layer.canvas, 0, 0);\r\n        });\r\n    }\r\n\r\n\r\n    #moveToInitialPosition(addPoint = true) {\r\n        if (!this.points.length && addPoint)\r\n            this.points.push({ x: this.initialPosition.x, y: this.initialPosition.y });\r\n        this.#clear();\r\n        this.createPath();\r\n        this.ctx.moveTo(this.initialPosition.x, this.initialPosition.y)\r\n        this.path.moveTo(this.initialPosition.x, this.initialPosition.y);\r\n    }\r\n\r\n    #moveToPreviousPosition() {\r\n        if (this.state.fill || this.state.clip) {\r\n            this.ctx.lineTo(this.previousPosition.x, this.previousPosition.y);\r\n            this.path?.lineTo?.(this.previousPosition.x, this.previousPosition.y);\r\n        } else {\r\n            this.ctx.moveTo(this.previousPosition.x, this.previousPosition.y);\r\n            this.path?.moveTo?.(this.previousPosition.x, this.previousPosition.y);\r\n        }\r\n    }\r\n\r\n    #createCurve() {\r\n        if (this.activeTool === 'K-bezier') {\r\n            this.points.push({ x: this.previousPosition.x, y: this.previousPosition.y });\r\n            this.points.push({ x: this.previousPosition.x, y: this.previousPosition.y });\r\n        }\r\n    }\r\n\r\n    #computeHandle(p, pPrev, pNext) {\r\n        if (!(p && pPrev && pNext)) return;\r\n\r\n        const { ux, uy } = (0,_utils_vector_js__WEBPACK_IMPORTED_MODULE_2__.calculateTangent)(pPrev, pNext);\r\n        const k = 0.25;\r\n\r\n        const lenPrev = Math.hypot(p.x - pPrev.x, p.y - pPrev.y);\r\n        const lenNext = Math.hypot(p.x - pNext.x, p.y - pNext.y);\r\n\r\n        const len = k * Math.min(lenPrev, lenNext);\r\n\r\n        return { prev: { x: p.x - ux * len, y: p.y - uy * len }, next: { x: p.x + ux * len, y: p.y + uy * len } };\r\n    }\r\n\r\n    #drawline() {\r\n        this.#clear();\r\n        this.createPath()\r\n        if (this.points.length) {\r\n            this.ctx.moveTo(this.points[0].x, this.points[0].y);\r\n            this.path.moveTo(this.points[0].x, this.points[0].y);\r\n        } else {\r\n            this.#moveToInitialPosition(false);\r\n        }\r\n    }\r\n\r\n    draw(x, y, state = null, activeToolId = null, layer = null) {\r\n        _app_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].isDirty = true;\r\n        this.state = state ?? _app_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].state;\r\n        this.activeTool = activeToolId ?? _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].activeToolId;\r\n        this.layer = layer ?? _layer_manager_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].getActiveLayer();\r\n\r\n        const drawGPath = ['P', 'L', 'K'].includes(this.activeTool[0]);\r\n        if (drawGPath)\r\n            this.ctx.beginPath();\r\n        if (!this.state.erase) {\r\n            switch (this.activeTool) {\r\n                case 'P-pen':\r\n                    this.#pen(x, y);\r\n                    break;\r\n                case 'P-chalk':\r\n                    this.#chalk(x, y);\r\n                    break;\r\n                case 'R-rectangle':\r\n                    this.#rectangle(x, y);\r\n                    break;\r\n                case 'R-roundrectangle':\r\n                    this.#roundRectangle(x, y);\r\n                    break;\r\n                case 'C-circle':\r\n                    this.#circle(x, y);\r\n                    break;\r\n                case 'C-ellipse':\r\n                    this.#ellipse(x, y);\r\n                    break;\r\n                case 'L-line':\r\n                    this.#line(x, y);\r\n                    break;\r\n                case 'L-arcto':\r\n                    this.#arcTo(x, y);\r\n                    break;\r\n                case 'K-bezier':\r\n                    this.#bezier(x, y);\r\n                    break;\r\n                case 'K-quadratic':\r\n                    this.#quadratic(x, y);\r\n                    break;\r\n                default:\r\n                    this.#eraser(x, y);\r\n                    break;\r\n            }\r\n\r\n            // this.ctx.fillStyle = 'red';\r\n            // this.ctx.strokeStyle = 'yellow';\r\n\r\n\r\n\r\n            if (this.state.fill && !drawGPath) {\r\n                this.ctx.fill(this.path);\r\n            }\r\n            if (drawGPath)\r\n                this.ctx.stroke();\r\n            else\r\n                this.ctx.stroke(this.path);\r\n\r\n            if (this.activeTool[0] === 'P') {\r\n                this.points.push({ x, y });\r\n            }\r\n\r\n            // if (state.clip) {\r\n            //     this.ctx.clip(this.path);\r\n            // }\r\n        } else {\r\n            this.#eraser(x, y);\r\n            this.points.push({ x, y });\r\n        }\r\n    }\r\n\r\n    #pen(x, y) {\r\n        this.#moveToPreviousPosition();\r\n        this.ctx.lineTo(x, y);\r\n        this.path.lineTo(x, y);\r\n    }\r\n\r\n    #chalk(x, y) {\r\n        this.#moveToPreviousPosition();\r\n        const path = this.path;\r\n        const tangent = (0,_utils_vector_js__WEBPACK_IMPORTED_MODULE_2__.calculateTangent)({ x, y }, this.previousPosition);\r\n        // const normal = calculateNormal(tangent);\r\n        const stepDX = tangent.ux;\r\n        const stepDY = tangent.uy;\r\n        const randomNess = 1;\r\n        const density = 1;\r\n        const pebbleSize = 0.1;\r\n\r\n        for (let i = 0; i < Math.floor(tangent.L); i++) {\r\n            for (let j = 0; j < density; j++) {\r\n                const xs = (x + (stepDX * i)) + (0,_utils_random_js__WEBPACK_IMPORTED_MODULE_1__.random)(-randomNess, randomNess);\r\n                const ys = (y + (stepDY * i)) + (0,_utils_random_js__WEBPACK_IMPORTED_MODULE_1__.random)(-randomNess, randomNess);\r\n\r\n                if (!this.state.fill) {\r\n                    path.moveTo(xs, ys);\r\n                }\r\n                this.ctx.moveTo(xs, ys);\r\n                this.ctx.arc(xs, ys, pebbleSize, 0, Math.PI * 2);\r\n                path.arc(xs, ys, pebbleSize, 0, Math.PI * 2);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    #rectangle(x, y) {\r\n        this.#moveToInitialPosition();\r\n        this.path.rect(this.initialPosition.x, this.initialPosition.y, x - this.initialPosition.x, y - this.initialPosition.y);\r\n    }\r\n\r\n    #roundRectangle(x, y) {\r\n        this.#moveToInitialPosition();\r\n        this.path.roundRect(this.initialPosition.x, this.initialPosition.y, x - this.initialPosition.x, y - this.initialPosition.y, 10);\r\n    }\r\n\r\n    #circle(x, y) {\r\n        this.#clear();\r\n        this.createPath()\r\n        const radius = Math.hypot(x - this.initialPosition.x, y - this.initialPosition.y);\r\n        this.path?.arc?.(this.initialPosition.x, this.initialPosition.y, radius, 0, Math.PI * 2);\r\n        if (!this.points.length) this.points.push({ x: this.initialPosition.x, y: this.initialPosition.y });\r\n    }\r\n    #ellipse(x, y) {\r\n        this.#clear();\r\n        this.createPath()\r\n        const radiusX = Math.abs(x - this.initialPosition.x);\r\n        const radiusY = Math.abs(y - this.initialPosition.y);\r\n        // const rotation = Math.atan2(y - this.initialPosition.y, x - this.initialPosition.x);\r\n        this.path?.ellipse?.(this.initialPosition.x, this.initialPosition.y, radiusX, radiusY, 0, 0, Math.PI * 2);\r\n        if (!this.points.length) this.points.push({ x: this.initialPosition.x, y: this.initialPosition.y });\r\n    }\r\n\r\n    #line(x, y) {\r\n        this.#drawline();\r\n        this.points.forEach(({ x, y }) => {\r\n            this.ctx.lineTo(x, y);\r\n            this.path?.lineTo?.(x, y);\r\n        })\r\n        this.ctx.lineTo(x, y);\r\n        // this.path.lineTo(x, y);\r\n    }\r\n\r\n    #arcTo(x, y) {\r\n        this.#drawline();\r\n        const points = [...this.points, { x, y }];\r\n        const count = points.length - 1;\r\n        for (let i = 1; i < count; i++) {\r\n            const p = points[i - 1];\r\n            const cp = points[i];\r\n            const p2 = points[i + 1];\r\n            const radius = Math.hypot(p.x - cp.x, p.y - cp.y) / 4;\r\n            this.ctx.arcTo(cp.x, cp.y, p2.x, p2.y, radius);\r\n            if (count !== i + 1)\r\n                this.path?.arcTo?.(cp.x, cp.y, p2.x, p2.y, radius);\r\n            else\r\n                this.path?.lineTo(cp.x, cp.y);\r\n        }\r\n\r\n        this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    #bezier(x, y) {\r\n        this.#drawline();\r\n        const count = this.points.length;\r\n        this.points[count - 1] = { x, y }\r\n\r\n        const handle = this.#computeHandle(this.points?.[count - 3], this.points?.[count - 6], { x, y });\r\n\r\n        if (handle && !_app_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].unloading) {\r\n            const { prev, next } = handle;\r\n            this.points[count - 4] = prev;\r\n            this.points[count - 2] = next;\r\n        }\r\n\r\n        for (let i = 1; i < count - 2; i += 3) {\r\n            const cp1 = this.points[i];\r\n            const cp2 = this.points[i + 1];\r\n            const p = this.points[i + 2];\r\n            this.ctx.bezierCurveTo?.(cp1.x, cp1.y, cp2.x, cp2.y, p.x, p.y);\r\n            this.path?.bezierCurveTo?.(cp1.x, cp1.y, cp2.x, cp2.y, p.x, p.y);\r\n        }\r\n\r\n        this.ctx.bezierCurveTo?.(this.points[count - 2]?.x, this.points[count - 2]?.y, this.points[count - 1]?.x, this.points[count - 1]?.y, x, y);\r\n    }\r\n\r\n\r\n    #quadratic(x, y) {\r\n        this.#drawline();\r\n        const count = this.points.length - 1;\r\n        for (let i = 1; i < count; i += 2) {\r\n            const p = this.points[i + 1];\r\n            const cp = this.points[i];\r\n            this.ctx.quadraticCurveTo?.(cp.x, cp.y, p.x, p.y);\r\n            this.path?.quadraticCurveTo?.(cp.x, cp.y, p.x, p.y);\r\n            this.ctx.circle(p.x, p.y, p.cp ? 'purple' : 'maroon')\r\n        }\r\n\r\n\r\n        if (this.points[count]?.x) {\r\n            this.ctx.quadraticCurveTo?.(this.points[count].x, this.points[count].y, x, y);\r\n        }\r\n    }\r\n\r\n\r\n    #eraser(x, y) {\r\n        const layer = this.layer;\r\n        const dX = this.previousPosition.x - x;\r\n        const dY = this.previousPosition.y - y;\r\n        const radius = Math.hypot(dX, dY);\r\n        if (radius <= 0) {\r\n            layer?.ctx?.clearRect?.(x, y, 5, 5);\r\n            return;\r\n        }\r\n\r\n        const stepDX = dX / radius;\r\n        const stepDY = dY / radius;\r\n        for (let i = 0; i < Math.floor(radius); i++) {\r\n            const xs = (x + (stepDX * i));\r\n            const ys = (y + (stepDY * i));\r\n            layer?.ctx?.clearRect?.(xs, ys, 5, 5);\r\n        }\r\n    }\r\n\r\n    static createCanvas(width, height) {\r\n        const offscreenCanvas = new OffscreenCanvas(width, height);\r\n        const ctx = offscreenCanvas.getContext('2d');\r\n        return offscreenCanvas;\r\n    }\r\n\r\n    static async createPreviewCanvas(offscreenCanvas) {\r\n        return await offscreenCanvas.convertToBlob();\r\n    }\r\n}\r\n\r\nconst canvas = new Canvas();\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });\n\n//# sourceURL=webpack://quanvas/./scripts/core/canvas/canvas.js?\n}");

/***/ }),

/***/ "./scripts/core/canvas/layer/layer.js":
/*!********************************************!*\
  !*** ./scripts/core/canvas/layer/layer.js ***!
  \********************************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ Layer)\n/* harmony export */ });\n/* harmony import */ var _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../shared/constants.js */ \"./scripts/shared/constants.js\");\n/* harmony import */ var _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../shared/domElem.js */ \"./scripts/shared/domElem.js\");\n/* harmony import */ var _memory_database_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../memory/database.js */ \"./scripts/core/memory/database.js\");\n/* harmony import */ var _manager_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./manager.js */ \"./scripts/core/canvas/layer/manager.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_memory_database_js__WEBPACK_IMPORTED_MODULE_2__, _manager_js__WEBPACK_IMPORTED_MODULE_3__]);\n([_memory_database_js__WEBPACK_IMPORTED_MODULE_2__, _manager_js__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\r\n\r\n\r\n\r\n\r\nclass Layer {\r\n    constructor(id, name, order, layerElem) {\r\n        const { width: lWidth, height: lHeight } = layerElem.getBoundingClientRect();\r\n\r\n        this.previousPosition = { x: 0, y: 0 };\r\n        this.initialPosition = { x: 0, y: 0 };\r\n\r\n        this.id = id;\r\n        this.name = name;\r\n        this.isDrawing = false;\r\n        this.data = new Set();\r\n\r\n        this.canvas = document.createElement('canvas');\r\n\r\n        this.layerCanvas = this.canvas.cloneNode();\r\n        this.canvas.dataset.id = id;\r\n        this.canvas.style.zIndex = order;\r\n        this.layerCanvas.dataset.id = id;\r\n\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootElem.appendChild(this.canvas);\r\n\r\n        this.layer = layerElem;\r\n\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.lctx = this.layerCanvas.getContext('2d');\r\n\r\n        this.canvas.width = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width;\r\n        this.canvas.height = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height;\r\n        this.layerCanvas.width = lWidth;\r\n        this.layerCanvas.height = lHeight;\r\n\r\n        this.nameElem = document.createElement('span');\r\n        this.nameElem.contentEditable = true;\r\n        this.nameElem.classList.add('layer-name');\r\n        this.nameElem.innerText = this.name;\r\n        this.nameElem.style.zIndex = 1;\r\n\r\n\r\n        layerElem.appendChild(this.nameElem);\r\n        layerElem.appendChild(this.layerCanvas);\r\n        this.#addEventListener();\r\n    }\r\n\r\n    #addEventListener() {\r\n        this.nameElem.addEventListener('blur', () => {\r\n            this.name = this.nameElem.innerText ?? 'Unnamed';\r\n            _manager_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].renameLayer(this.id, this.name);\r\n        });\r\n\r\n        this.nameElem.addEventListener('keydown', (e) => {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                this.nameElem.blur();\r\n            }\r\n        });\r\n    }\r\n\r\n    drawPath(path, fill, clip) {\r\n        if (clip) {\r\n            this.ctx.clip(path);\r\n            if (!fill) this.ctx.stroke(path);\r\n        } else {\r\n            if (fill) {\r\n                this.ctx.fill(path);\r\n            }\r\n            this.ctx.stroke(path);\r\n        }\r\n\r\n        this.lctx.clearRect(0, 0, this.layerCanvas.width, this.layerCanvas.height);\r\n        this.lctx.drawImage(this.canvas, 0, 0, this.layerCanvas.width, this.layerCanvas.height);\r\n    }\r\n\r\n    addData(path, data) {\r\n        data['path'] = path;\r\n        this.data.add(data);\r\n    }\r\n\r\n    clear() {\r\n        this.canvas.width = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.width;\r\n        this.canvas.height = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.CANVAS_PROP.height;\r\n    }\r\n\r\n    setName(id, name) {\r\n        this.name = name;\r\n        this.nameElem.innerText = this.name;\r\n        _memory_database_js__WEBPACK_IMPORTED_MODULE_2__.dbOperations.updateLayer(id, {\r\n            name\r\n        })\r\n    }\r\n}\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });\n\n//# sourceURL=webpack://quanvas/./scripts/core/canvas/layer/layer.js?\n}");

/***/ }),

/***/ "./scripts/core/canvas/layer/manager.js":
/*!**********************************************!*\
  !*** ./scripts/core/canvas/layer/manager.js ***!
  \**********************************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./layer.js */ \"./scripts/core/canvas/layer/layer.js\");\n/* harmony import */ var _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../shared/domElem.js */ \"./scripts/shared/domElem.js\");\n/* harmony import */ var _app_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../app.js */ \"./scripts/core/app.js\");\n/* harmony import */ var _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../toolbox/manager.js */ \"./scripts/core/toolbox/manager.js\");\n/* harmony import */ var _serialization_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./serialization.js */ \"./scripts/core/canvas/layer/serialization.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! uuid */ \"./node_modules/uuid/dist/v4.js\");\n/* harmony import */ var _memory_database_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../memory/database.js */ \"./scripts/core/memory/database.js\");\n/* harmony import */ var _canvas_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../canvas.js */ \"./scripts/core/canvas/canvas.js\");\n/* harmony import */ var _utils_random_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../utils/random.js */ \"./scripts/utils/random.js\");\n/* harmony import */ var _memory_history_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../memory/history.js */ \"./scripts/core/memory/history.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_layer_js__WEBPACK_IMPORTED_MODULE_0__, _app_js__WEBPACK_IMPORTED_MODULE_2__, _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_3__, _memory_database_js__WEBPACK_IMPORTED_MODULE_6__, _canvas_js__WEBPACK_IMPORTED_MODULE_7__, _memory_history_js__WEBPACK_IMPORTED_MODULE_9__]);\n([_layer_js__WEBPACK_IMPORTED_MODULE_0__, _app_js__WEBPACK_IMPORTED_MODULE_2__, _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_3__, _memory_database_js__WEBPACK_IMPORTED_MODULE_6__, _canvas_js__WEBPACK_IMPORTED_MODULE_7__, _memory_history_js__WEBPACK_IMPORTED_MODULE_9__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst addLayerElem = document.getElementById('addlayer');\r\nconst sortPos = [0, 0];\r\n\r\nclass LayerManager {\r\n    constructor() {\r\n        this.layers = new Map();\r\n        this.activeLayerId = null;\r\n        this.focusedLayerId = null;\r\n        this.lastLayerId = null;\r\n        this.project = null;\r\n        this.#addEventListener();\r\n    }\r\n\r\n    #addEventListener() {\r\n        addLayerElem.addEventListener('click', _ => {\r\n            this.createLayer({});\r\n        });\r\n\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.addEventListener('dragstart', (e) => {\r\n            const layer = e.target.closest('.layer');\r\n            if (!layer) return;\r\n            layer.classList.add('dragging');\r\n        });\r\n\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.addEventListener('dragend', (e) => {\r\n            const layer = e.target.closest('.layer');\r\n            if (!layer) return;\r\n            layer.classList.remove('dragging');\r\n            if (sortPos[0])\r\n                this.reOrder(...sortPos);\r\n\r\n            sortPos[0] = 0;\r\n        });\r\n\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n            const afterElement = this.#getDragAfterElement(e.clientY);\r\n            const draggable = _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.querySelector(\".dragging\");\r\n            if (!draggable) return;\r\n            this.changePosition(draggable, afterElement)\r\n\r\n            _memory_history_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].updateHistory({\r\n                type: 'chanege-layer-pos',\r\n                layerId: this.activeLayerId,\r\n                dragElemId: draggable.dataset.id,\r\n                afterElemId: afterElement?.dataset?.id,\r\n            });\r\n        });\r\n    }\r\n\r\n    init() {\r\n        this.#clearAll();\r\n    }\r\n\r\n    async createLayer({ id = null, name = null, order = null, skipHistory = false }) {\r\n        try {\r\n            const projectId = _memory_database_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].getCurrentProjectID();\r\n            if (!projectId) return;\r\n\r\n            id = id ?? (0,uuid__WEBPACK_IMPORTED_MODULE_5__[\"default\"])();\r\n            order = order ?? this.layers.size + 1;\r\n            name = name ?? `Layer ${order}${String.fromCharCode((0,_utils_random_js__WEBPACK_IMPORTED_MODULE_8__.random)(97, 123))}`;\r\n\r\n            const layerDivElem = document.createElement('div');\r\n            layerDivElem.classList.add('layer');\r\n            layerDivElem.draggable = true;\r\n            layerDivElem.tabIndex = 0; // Make div focusable\r\n            layerDivElem.dataset.id = id;\r\n            layerDivElem.dataset.order = order;\r\n            _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.prepend(layerDivElem);\r\n            const layer = new _layer_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](id, name, order, layerDivElem);\r\n            this.layers.set(id, layer);\r\n\r\n            layerDivElem.addEventListener('click', e => {\r\n                if (e.target.classList.contains('layer-name')) return;\r\n                this.setActiveLayer(e.currentTarget.dataset.id);\r\n                this.focusedLayerId = e.currentTarget.dataset.id;\r\n                e.currentTarget.focus();\r\n            });\r\n\r\n            layerDivElem.addEventListener('focus', e => {\r\n                this.focusedLayerId = e.currentTarget.dataset.id;\r\n            });\r\n\r\n            layerDivElem.addEventListener('blur', e => {\r\n                if (!_shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.contains(e.relatedTarget)) {\r\n                    this.focusedLayerId = null;\r\n                }\r\n            });\r\n\r\n            layerDivElem.addEventListener('keydown', e => {\r\n                switch (e.key) {\r\n                    case 'Enter':\r\n                    case ' ':\r\n                        e.preventDefault();\r\n                        this.setActiveLayer(e.currentTarget.dataset.id);\r\n                        break;\r\n                    case 'Delete':\r\n                        e.preventDefault();\r\n                        if (this.focusedLayerId === e.currentTarget.dataset.id && !e.target.classList.contains('layer-name'))\r\n                            this.removeLayer();\r\n                        break;\r\n                    case 'ArrowUp':\r\n                        e.preventDefault();\r\n                        this.#focusAdjacentLayer(e.currentTarget, -1);\r\n                        break;\r\n                    case 'ArrowDown':\r\n                        e.preventDefault();\r\n                        this.#focusAdjacentLayer(e.currentTarget, 1);\r\n                        break;\r\n                }\r\n            });\r\n\r\n            const paths = await _memory_database_js__WEBPACK_IMPORTED_MODULE_6__.dbOperations.getPathsByLayer(id);\r\n\r\n            if (paths.length) {\r\n                for (const pathData of paths) {\r\n                    const unserializedData = _serialization_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].unserialize(pathData);\r\n                    _canvas_js__WEBPACK_IMPORTED_MODULE_7__.canvas.flushToPath(unserializedData);\r\n                }\r\n            } else {\r\n                await _memory_database_js__WEBPACK_IMPORTED_MODULE_6__.dbOperations.createLayer({\r\n                    id: id,\r\n                    projectId,\r\n                    name: layer.name,\r\n                    order\r\n                })\r\n            }\r\n\r\n            if (!skipHistory) {\r\n                _memory_history_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].updateHistory({\r\n                    type: 'create-layer',\r\n                    layerId: id,\r\n                    activeLayerId: this.activeLayerId,\r\n                    name: layer.name,\r\n                    order\r\n                });\r\n            }\r\n\r\n            this.setActiveLayer(id, true);\r\n        } catch (error) {\r\n            console.error('Error creating layer:', error);\r\n        }\r\n    }\r\n\r\n    changePosition(draggable, afterElement) {\r\n        if (afterElement == null) {\r\n            const dCanvas = this.layers.get(draggable.dataset.id);\r\n            _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.appendChild(dCanvas.layer);\r\n            sortPos[1] = 0;\r\n        } else {\r\n            const dCanvas = this.layers.get(draggable.dataset.id);\r\n            const aCanvas = this.layers.get(afterElement.dataset.id);\r\n            _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.insertBefore(dCanvas.layer, aCanvas.layer);\r\n            sortPos[0] = Number(dCanvas.layer.dataset.order);\r\n            sortPos[1] = Number(aCanvas.layer.dataset.order);\r\n        }\r\n    }\r\n\r\n    async reOrder(fromOrder, toOrder) {\r\n        const elements = Array.from(_shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.children);\r\n\r\n        if (fromOrder > toOrder) {\r\n            for (let i = elements.length - fromOrder; i < elements.length - toOrder; i++) {\r\n                const order = Number(elements[i].dataset.order);\r\n                let pos;\r\n\r\n                if (order === fromOrder)\r\n                    pos = toOrder + 1;\r\n                else\r\n                    pos = order + 1;\r\n\r\n                elements[i].dataset.order = pos;\r\n\r\n\r\n                this.layers.get(elements[i].dataset.id).canvas.style.zIndex = pos;\r\n                await _memory_database_js__WEBPACK_IMPORTED_MODULE_6__.dbOperations.updateLayer(elements[i].dataset.id, {\r\n                    order: pos\r\n                });\r\n            }\r\n        } else {\r\n            for (let i = elements.length - toOrder; i < elements.length - fromOrder + 1; i++) {\r\n                const order = Number(elements[i].dataset.order);\r\n                const canvas = this.layers.get(elements[i].dataset.id)?.canvas;\r\n                let pos;\r\n\r\n                if (order === fromOrder)\r\n                    pos = toOrder;\r\n                else\r\n                    pos = order - 1;\r\n\r\n                elements[i].dataset.order = pos;\r\n                if (canvas)\r\n                    canvas.style.zIndex = pos;\r\n                await _memory_database_js__WEBPACK_IMPORTED_MODULE_6__.dbOperations.updateLayer(elements[i].dataset.id, {\r\n                    order: pos\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    getLayer(id) {\r\n        return this.layers.get(id);\r\n    }\r\n\r\n    getActiveLayer() {\r\n        return this.getLayer(this.activeLayerId);\r\n    }\r\n\r\n    async saveDrawing(path, points, state) {\r\n        const layer = this.getActiveLayer();\r\n\r\n        if (layer == null) {\r\n            console.warn('No active layer to save drawing');\r\n            return;\r\n        }\r\n\r\n        const data = _serialization_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].serialize({\r\n            points,\r\n            state: _app_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].state,\r\n            type: _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].activeToolId,\r\n            layerId: layer.id,\r\n            projectId: _memory_database_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].getCurrentProjectID(),\r\n        })\r\n\r\n        layer.drawPath(path, state.fill, state.clip);\r\n\r\n        const res = await _memory_database_js__WEBPACK_IMPORTED_MODULE_6__.dbOperations.createPath(data);\r\n        layer.addData(path, data);\r\n\r\n        _memory_history_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].updateHistory({\r\n            type: 'save-drawing',\r\n            layerId: this.activeLayerId,\r\n            pathId: res.id\r\n        })\r\n    }\r\n\r\n    async saveDrawingIn(id, path, points, state) {\r\n        const layer = this.getLayer(id);\r\n\r\n        if (layer == null) {\r\n            console.warn('No layer to save drawing');\r\n            return;\r\n        }\r\n\r\n        const data = _serialization_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].serialize({\r\n            points,\r\n            state: _app_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].state,\r\n            type: _toolbox_manager_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].activeToolId,\r\n            layerId: layer.id,\r\n            projectId: _memory_database_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].getCurrentProjectID(),\r\n        })\r\n\r\n        layer.drawPath(path, state.fill, state.clip);\r\n        layer.addData(path, data);\r\n    }\r\n\r\n    setActiveLayer(id, skipHistory = false) {\r\n        const layer = this.layers.get(this.activeLayerId);\r\n        layer?.layer?.classList?.remove('selectedLayer');\r\n\r\n        const newLayer = this.layers.get(id)\r\n        newLayer?.layer?.classList?.add('selectedLayer');\r\n\r\n        this.activeLayerId = id;\r\n\r\n        if (skipHistory) return;\r\n        _memory_history_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].updateHistory({\r\n            type: 'set-active-layer',\r\n            layerId: this.activeLayerId,\r\n        })\r\n    }\r\n\r\n    renameLayer(id, name) {\r\n        const layer = this.layers.get(id);\r\n        _memory_history_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].updateHistory({\r\n            type: 'rename-layer',\r\n            layerId: id,\r\n            oldName: layer.name\r\n        })\r\n\r\n        layer.setName(id, name);\r\n    }\r\n\r\n    async removeLayer(layerId = null, skipHistory = false) {\r\n        if (!this.focusedLayerId && !layerId) return;\r\n        const id = layerId ?? this.focusedLayerId;\r\n\r\n        const layer = this.layers.get(id);\r\n        if (!layer) return;\r\n\r\n        try {\r\n            await _memory_database_js__WEBPACK_IMPORTED_MODULE_6__.dbOperations.deleteLayer(id);\r\n            const order = layer.layer.dataset.order;\r\n            this.reOrder(order, this.layers.size)\r\n\r\n            layer.layer.remove();\r\n            layer.canvas.remove();\r\n\r\n            this.layers.delete(id);\r\n\r\n            this.focusedLayerId = null;\r\n\r\n            if (this.activeLayerId === id) {\r\n                this.activeLayerId = null;\r\n                const firstLayer = this.layers.values().next().value;\r\n                if (firstLayer) {\r\n                    this.setActiveLayer(firstLayer.id, true);\r\n                }\r\n            }\r\n\r\n\r\n            console.log('Remove layer', id, layer);\r\n            if (skipHistory) return;\r\n\r\n            if (layerId === null)\r\n                _memory_history_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].history.pop()\r\n            _memory_history_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"].updateHistory({\r\n                type: 'remove-layer',\r\n                layerId: id,\r\n                name: layer.name,\r\n                order: order,\r\n                data: layer.data\r\n            })\r\n        } catch (error) {\r\n            console.error('Error removing layer:', error);\r\n        }\r\n\r\n    }\r\n\r\n    #clearAll() {\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootElem.innerHTML = '';\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.innerHTML = '';\r\n        _shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.rootElem.append(_canvas_js__WEBPACK_IMPORTED_MODULE_7__.canvas.canvas);\r\n        this.layers.clear();\r\n        this.activeLayerId = null;\r\n        localStorage.removeItem('current-project')\r\n    }\r\n\r\n    #getDragAfterElement(y) {\r\n        const elements = Array.from(_shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.querySelectorAll('.layer:not(.dragging)'));\r\n        return elements.reduce(\r\n            (closest, child) => {\r\n                const box = child.getBoundingClientRect();\r\n                const offset = y - box.top - box.height / 2;\r\n                if (offset < 0 && offset > closest.offset) {\r\n                    return { offset: offset, element: child };\r\n                } else {\r\n                    return closest;\r\n                }\r\n            },\r\n            { offset: Number.NEGATIVE_INFINITY }\r\n        ).element;\r\n    }\r\n\r\n    #focusAdjacentLayer(currentElement, direction) {\r\n        const layerElements = Array.from(_shared_domElem_js__WEBPACK_IMPORTED_MODULE_1__.layersElem.querySelectorAll('.layer'));\r\n        const currentIndex = layerElements.indexOf(currentElement);\r\n        const nextIndex = currentIndex + direction;\r\n\r\n        if (nextIndex >= 0 && nextIndex < layerElements.length) {\r\n            const nextLayer = layerElements[nextIndex];\r\n            nextLayer.focus();\r\n            this.focusedLayerId = nextLayer.dataset.id;\r\n        }\r\n    }\r\n}\r\n\r\nconst layerManager = new LayerManager();\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (layerManager);\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });\n\n//# sourceURL=webpack://quanvas/./scripts/core/canvas/layer/manager.js?\n}");

/***/ }),

/***/ "./scripts/core/canvas/layer/serialization.js":
/*!****************************************************!*\
  !*** ./scripts/core/canvas/layer/serialization.js ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ Serializer)\n/* harmony export */ });\nclass Serializer {\r\n    static serialize(data) {\r\n        const points = data.points;\r\n        const buffer = new ArrayBuffer(8 * points.length);\r\n\r\n        const view = new Float32Array(buffer);\r\n\r\n        let i = 0;\r\n        for (const point of points) {\r\n            view[i++] = point.x;\r\n            view[i++] = point.y;\r\n        }\r\n\r\n        return {\r\n            ...data,\r\n            points: buffer\r\n        }\r\n    }\r\n\r\n    static unserialize(data) {\r\n        const buffer = data.points;\r\n        const view = new Float32Array(buffer);\r\n        const points = [];\r\n        for (let i = 0; i < view.length; i += 2) {\r\n            points.push({ x: view[i], y: view[i + 1] });\r\n        }\r\n\r\n        return {\r\n            ...data,\r\n            points\r\n        }\r\n    }\r\n}\n\n//# sourceURL=webpack://quanvas/./scripts/core/canvas/layer/serialization.js?\n}");

/***/ }),

/***/ "./scripts/core/memory/database.js":
/*!*****************************************!*\
  !*** ./scripts/core/memory/database.js ***!
  \*****************************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   database: () => (/* binding */ database),\n/* harmony export */   dbOperations: () => (/* binding */ dbOperations),\n/* harmony export */   \"default\": () => (/* binding */ Database)\n/* harmony export */ });\nclass Database {\r\n    constructor(dBName, version = 1) {\r\n        this.dBName = dBName;\r\n        this.version = version;\r\n        this.db = null;\r\n    }\r\n\r\n    async open(stores = []) {\r\n        return new Promise((resolve, reject) => {\r\n            const request = indexedDB.open(this.dBName, this.version);\r\n\r\n            request.addEventListener(\"upgradeneeded\", (e) => {\r\n                const db = e.target.result;\r\n\r\n                stores.forEach((store) => {\r\n                    if (!db.objectStoreNames.contains(store.name)) {\r\n                        const objectStore = db.createObjectStore(store.name, {\r\n                            keyPath: store.keyPath || 'id',\r\n                            autoIncrement: store.autoIncrement ?? true\r\n                        });\r\n\r\n                        if (store.indexes) {\r\n                            store.indexes.forEach(index => {\r\n                                objectStore.createIndex(index.name, index.keyPath, { unique: index.unique || false });\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            })\r\n\r\n            request.addEventListener(\"success\", e => {\r\n                this.db = e.target.result;\r\n                resolve(this.db);\r\n            })\r\n\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    async put(storeName, data) {\r\n        return new Promise((resolve, reject) => {\r\n            const tx = this.db.transaction(storeName, \"readwrite\");\r\n\r\n            const request = tx.objectStore(storeName).put(data);\r\n            request.addEventListener(\"success\", _ => {\r\n                resolve(true);\r\n            })\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    async get(storeName, key) {\r\n        return new Promise((resolve, reject) => {\r\n            const tx = this.db.transaction(storeName, \"readonly\");\r\n\r\n            const request = tx.objectStore(storeName).get(key);\r\n            request.addEventListener(\"success\", e => {\r\n                resolve(e.target.result);\r\n            })\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    async getAll(storeName) {\r\n        return new Promise((resolve, reject) => {\r\n            const tx = this.db.transaction(storeName, \"readonly\");\r\n\r\n            const request = tx.objectStore(storeName).getAll();\r\n            request.addEventListener(\"success\", e => {\r\n                resolve(e.target.result);\r\n            })\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    async getByIndex(storeName, indexName, indexValue) {\r\n        return new Promise((resolve, reject) => {\r\n            const tx = this.db.transaction(storeName, \"readonly\");\r\n            const index = tx.objectStore(storeName).index(indexName);\r\n            const request = index.get(indexValue);\r\n            request.addEventListener(\"success\", e => {\r\n                resolve(e.target.result);\r\n            })\r\n\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    async getAllByIndex(storeName, indexName, indexValue) {\r\n        return new Promise((resolve, reject) => {\r\n            const tx = this.db.transaction(storeName, \"readonly\");\r\n            const index = tx.objectStore(storeName).index(indexName);\r\n            const request = index.getAll(indexValue);\r\n            request.addEventListener(\"success\", e => {\r\n                resolve(e.target.result);\r\n            })\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    async delete(storeName, key) {\r\n        return new Promise((resolve, reject) => {\r\n            const tx = this.db.transaction(storeName, \"readwrite\");\r\n\r\n            const request = tx.objectStore(storeName).delete(key);\r\n            request.addEventListener(\"success\", _ => {\r\n                resolve(true);\r\n            })\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    async clear(storeName) {\r\n        return new Promise((resolve, reject) => {\r\n            const tx = this.db.transaction(storeName, \"readwrite\");\r\n\r\n            const request = tx.objectStore(storeName).clear();\r\n            request.addEventListener(\"success\", _ => {\r\n                resolve(true);\r\n            })\r\n            request.addEventListener(\"error\", e => {\r\n                reject(e.target.error);\r\n            })\r\n        })\r\n    }\r\n\r\n    getProject() {\r\n        const projectId = Database.getCurrentProjectID();\r\n        return this.get('projects', projectId);\r\n    }\r\n\r\n    static getCurrentProjectID() {\r\n        return localStorage.getItem('current-project');\r\n    }\r\n}\r\n\r\n\r\nconst database = new Database('quanvas-db-v1', 1);\r\n\r\n\r\nconst storeDefinitions = [\r\n    {\r\n        name: 'projects',\r\n        keyPath: 'id',\r\n        indexes: [\r\n            { name: 'name', keyPath: 'name', unique: false },\r\n            { name: 'createdAt', keyPath: 'createdAt', unique: false },\r\n            { name: 'updatedAt', keyPath: 'updatedAt', unique: false }\r\n        ]\r\n    },\r\n    {\r\n        name: 'layers',\r\n        keyPath: 'id',\r\n        indexes: [\r\n            { name: 'projectId', keyPath: 'projectId', unique: false },\r\n            { name: 'name', keyPath: 'name', unique: false },\r\n            { name: 'order', keyPath: 'order', unique: false },\r\n        ]\r\n    },\r\n    {\r\n        name: 'paths',\r\n        keyPath: 'id',\r\n        autoIncrement: true,\r\n        indexes: [\r\n            { name: 'layerId', keyPath: 'layerId', unique: false },\r\n            { name: 'projectId', keyPath: 'projectId', unique: false },\r\n            { name: 'type', keyPath: 'type', unique: false },\r\n            { name: 'createdAt', keyPath: 'createdAt', unique: false }\r\n        ]\r\n    }\r\n];\r\n\r\ntry {\r\n    await database.open(storeDefinitions);\r\n    console.log('Database initialized successfully');\r\n} catch (error) {\r\n    console.error('Failed to initialize database:', error);\r\n    throw error;\r\n}\r\n\r\n\r\n\r\nconst dbOperations = {\r\n    async createProject(projectData) {\r\n        const project = {\r\n            ...projectData,\r\n            createdAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString()\r\n        };\r\n        return await database.put('projects', project);\r\n    },\r\n\r\n    async getProject(projectId) {\r\n        return await database.get('projects', projectId);\r\n    },\r\n\r\n    async getAllProjects() {\r\n        return await database.getAll('projects');\r\n    },\r\n\r\n    async updateProject(projectId, updateData) {\r\n        const project = await database.get('projects', projectId);\r\n        if (project) {\r\n            const updatedProject = {\r\n                ...project,\r\n                ...updateData,\r\n                updatedAt: new Date().toISOString()\r\n            };\r\n            return await database.put('projects', updatedProject);\r\n        }\r\n        return false;\r\n    },\r\n\r\n    async deleteProject(projectId) {\r\n        localStorage.removeItem('current-project');\r\n        const layers = await database.getAllByIndex('layers', 'projectId', projectId);\r\n\r\n        if (layers.length !== 0) {\r\n            layers.forEach(async (layer) => {\r\n                await database.delete('layers', layer.id);\r\n            });\r\n\r\n            const paths = await database.getAllByIndex('paths', 'projectId', projectId);\r\n            if (paths.length !== 0) {\r\n                paths.forEach(async (path) => {\r\n                    await database.delete('paths', path.id);\r\n                });\r\n            }\r\n\r\n            return await database.delete('projects', projectId);\r\n        }\r\n    },\r\n\r\n    async createLayer(layerData) {\r\n        const layer = {\r\n            ...layerData,\r\n            createdAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString()\r\n        };\r\n        return await database.put('layers', layer);\r\n    },\r\n\r\n    async getLayer(layerId) {\r\n        return await database.get('layers', layerId);\r\n    },\r\n\r\n    async getAllLayers() {\r\n        return await database.getAll('layers');\r\n    },\r\n\r\n    async getLayersByProject(projectId) {\r\n        return await database.getAllByIndex('layers', 'projectId', projectId);\r\n    },\r\n\r\n    async updateLayer(layerId, updateData) {\r\n        const layer = await database.get('layers', layerId);\r\n        if (layer) {\r\n            const updatedLayer = {\r\n                ...layer,\r\n                ...updateData,\r\n                updatedAt: new Date().toISOString()\r\n            };\r\n            return await database.put('layers', updatedLayer);\r\n        }\r\n        return false;\r\n    },\r\n\r\n    async deleteLayer(layerId) {\r\n        const paths = await database.getAllByIndex('paths', 'layerId', layerId);\r\n        if (paths.length !== 0) {\r\n            paths.forEach(async (path) => {\r\n                await database.delete('paths', path.id);\r\n            });\r\n        }\r\n\r\n        return await database.delete('layers', layerId);\r\n    },\r\n\r\n    async createPath(pathData) {\r\n        const path = {\r\n            ...pathData,\r\n            createdAt: new Date().toISOString()\r\n        };\r\n        return await database.put('paths', path);\r\n    },\r\n\r\n    async getPath(pathId) {\r\n        return await database.get('paths', pathId);\r\n    },\r\n\r\n    async getPathsByLayer(layerId) {\r\n        return await database.getAllByIndex('paths', 'layerId', layerId);\r\n    },\r\n\r\n    async getPathsByProject(projectId) {\r\n        return await database.getAllByIndex('paths', 'projectId', projectId);\r\n    },\r\n\r\n    async updatePath(pathId, updateData) {\r\n        const path = await database.get('paths', pathId);\r\n        if (path) {\r\n            const updatedPath = { ...path, ...updateData };\r\n            return await database.put('paths', updatedPath);\r\n        }\r\n        return false;\r\n    },\r\n\r\n    async deletePath(pathId) {\r\n        return await database.delete('paths', pathId);\r\n    },\r\n\r\n    async clearAllData() {\r\n        await database.clear('projects');\r\n        await database.clear('layers');\r\n        await database.clear('paths');\r\n    }\r\n};\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } }, 1);\n\n//# sourceURL=webpack://quanvas/./scripts/core/memory/database.js?\n}");

/***/ }),

/***/ "./scripts/core/memory/history.js":
/*!****************************************!*\
  !*** ./scripts/core/memory/history.js ***!
  \****************************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../canvas/layer/manager.js */ \"./scripts/core/canvas/layer/manager.js\");\n/* harmony import */ var _database_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./database.js */ \"./scripts/core/memory/database.js\");\n/* harmony import */ var _canvas_layer_serialization_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../canvas/layer/serialization.js */ \"./scripts/core/canvas/layer/serialization.js\");\n/* harmony import */ var _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../canvas/canvas.js */ \"./scripts/core/canvas/canvas.js\");\n/* harmony import */ var _app_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../app.js */ \"./scripts/core/app.js\");\n/* harmony import */ var _shared_domElem_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../shared/domElem.js */ \"./scripts/shared/domElem.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__, _database_js__WEBPACK_IMPORTED_MODULE_1__, _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_3__, _app_js__WEBPACK_IMPORTED_MODULE_4__]);\n([_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__, _database_js__WEBPACK_IMPORTED_MODULE_1__, _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_3__, _app_js__WEBPACK_IMPORTED_MODULE_4__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass HistoryManager {\r\n    constructor() {\r\n        this.history = [];\r\n        this.redoStack = [];\r\n    }\r\n\r\n    updateHistory(data) {\r\n        if (_app_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].unloading) return;\r\n        this.history.push(data);\r\n        this.redoStack = [];\r\n    }\r\n\r\n    async undo() {\r\n        if (this.history.length === 0) return null;\r\n        const lastState = this.history.pop();\r\n        this.redoStack.push(lastState);\r\n        try {\r\n            await this.#replayUndo(lastState);\r\n        } catch (e) {\r\n            console.error('Undo failed', e);\r\n        }\r\n        return lastState;\r\n    }\r\n\r\n    async redo() {\r\n        if (this.redoStack.length === 0) return null;\r\n        const lastState = this.redoStack.pop();\r\n        this.history.push(lastState);\r\n        try {\r\n            await this.#replayRedo(lastState);\r\n        } catch (e) {\r\n            console.error('Redo failed', e);\r\n        }\r\n        return lastState;\r\n    }\r\n\r\n    clearHistory() {\r\n        this.history = [];\r\n        this.redoStack = [];\r\n    }\r\n\r\n    async #replayUndo(entry) {\r\n        if (!entry || !entry.type) return;\r\n\r\n        switch (entry.type) {\r\n            case 'create-layer': {\r\n                const id = entry.layerId;\r\n                const layer = _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getLayer(id);\r\n                if (layer) {\r\n                    layer.layer.remove();\r\n                    layer.canvas.remove();\r\n                    _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].layers.delete(id);\r\n                    _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setActiveLayer(entry.activeLayerId, true)\r\n                }\r\n                try { await _database_js__WEBPACK_IMPORTED_MODULE_1__.dbOperations.deleteLayer(id); } catch (e) { }\r\n                break;\r\n            }\r\n\r\n            case 'remove-layer': {\r\n                const { layerId, name, order, data } = entry;\r\n                await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createLayer({ id: layerId, name, order, skipHistory: true });\r\n                const elements = Array.from(_shared_domElem_js__WEBPACK_IMPORTED_MODULE_5__.layersElem.children);\r\n\r\n                const element = elements.find(el => Math.min(Number(el.dataset.order) + 1, _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].layers.size) === Number(order));\r\n\r\n                _shared_domElem_js__WEBPACK_IMPORTED_MODULE_5__.layersElem.insertBefore(_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getLayer(layerId).layer, element);\r\n                await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].reOrder(_canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].layers.size, order);\r\n\r\n                if (data && data.length) {\r\n                    for (const p of data) {\r\n                        try { await _database_js__WEBPACK_IMPORTED_MODULE_1__.dbOperations.createPath(p); } catch (e) { }\r\n                        const unser = _canvas_layer_serialization_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].unserialize(p);\r\n                        _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_3__.canvas.flushToPath(unser);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'save-drawing': {\r\n                const { layerId, pathId } = entry;\r\n                try {\r\n                    if (pathId) await _database_js__WEBPACK_IMPORTED_MODULE_1__.dbOperations.deletePath(pathId);\r\n                } catch (e) { }\r\n\r\n                const layer = _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getLayer(layerId);\r\n                if (layer) {\r\n                    layer.clear();\r\n                    const paths = await _database_js__WEBPACK_IMPORTED_MODULE_1__.dbOperations.getPathsByLayer(layerId);\r\n                    for (const p of paths) {\r\n                        const unser = _canvas_layer_serialization_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].unserialize(p);\r\n                        _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_3__.canvas.flushToPath(unser);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'set-active-layer': {\r\n                const prev = entry.prevLayerId ?? null;\r\n                if (prev) _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setActiveLayer(prev);\r\n                break;\r\n            }\r\n\r\n            case 'rename-layer': {\r\n                const { layerId, oldName } = entry;\r\n                const layer = _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getLayer(layerId);\r\n                if (layer) layer.setName(layerId, oldName);\r\n                break;\r\n            }\r\n\r\n            case 'change-layer-pos':\r\n            case 'chanege-layer-pos': {\r\n                const { fromOrder, toOrder } = entry;\r\n                if (typeof fromOrder === 'number' && typeof toOrder === 'number') {\r\n                    await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].reOrder(toOrder, fromOrder);\r\n                }\r\n                break;\r\n            }\r\n\r\n            default:\r\n                console.warn('Unknown history undo type', entry.type);\r\n        }\r\n    }\r\n\r\n    async #replayRedo(entry) {\r\n        if (!entry || !entry.type) return;\r\n\r\n        switch (entry.type) {\r\n            case 'create-layer': {\r\n                const { layerId, name, order } = entry;\r\n                await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createLayer({ id: layerId, name, order, skipHistory: true });\r\n                break;\r\n            }\r\n\r\n            case 'remove-layer': {\r\n                const id = entry.layerId;\r\n                await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].removeLayer(id, true);\r\n                break;\r\n            }\r\n\r\n            case 'save-drawing': {\r\n                const { savedData, layerId } = entry;\r\n                if (savedData) {\r\n                    try {\r\n                        const res = await _database_js__WEBPACK_IMPORTED_MODULE_1__.dbOperations.createPath(savedData);\r\n                        const unser = _canvas_layer_serialization_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].unserialize(savedData);\r\n                        _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_3__.canvas.flushToPath(unser);\r\n                    } catch (e) { }\r\n                }\r\n                break;\r\n            }\r\n\r\n            case 'set-active-layer': {\r\n                const id = entry.layerId;\r\n                if (id) _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setActiveLayer(id);\r\n                break;\r\n            }\r\n\r\n            case 'rename-layer': {\r\n                const { layerId, newName } = entry;\r\n                const layer = _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getLayer(layerId);\r\n                if (layer) layer.setName(layerId, newName);\r\n                break;\r\n            }\r\n\r\n            case 'change-layer-pos':\r\n            case 'chanege-layer-pos': {\r\n                const { fromOrder, toOrder } = entry;\r\n                if (typeof fromOrder === 'number' && typeof toOrder === 'number') {\r\n                    await _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].reOrder(fromOrder, toOrder);\r\n                }\r\n                break;\r\n            }\r\n\r\n            default:\r\n                console.warn('Unknown history redo type', entry.type);\r\n        }\r\n    }\r\n}\r\n\r\nconst history = new HistoryManager();\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (history);\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });\n\n//# sourceURL=webpack://quanvas/./scripts/core/memory/history.js?\n}");

/***/ }),

/***/ "./scripts/core/projects.js":
/*!**********************************!*\
  !*** ./scripts/core/projects.js ***!
  \**********************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ Project),\n/* harmony export */   project: () => (/* binding */ project)\n/* harmony export */ });\n/* harmony import */ var _app_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./app.js */ \"./scripts/core/app.js\");\n/* harmony import */ var _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./canvas/canvas.js */ \"./scripts/core/canvas/canvas.js\");\n/* harmony import */ var _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./canvas/layer/manager.js */ \"./scripts/core/canvas/layer/manager.js\");\n/* harmony import */ var _memory_database_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./memory/database.js */ \"./scripts/core/memory/database.js\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! uuid */ \"./node_modules/uuid/dist/v4.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_app_js__WEBPACK_IMPORTED_MODULE_0__, _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__, _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_2__, _memory_database_js__WEBPACK_IMPORTED_MODULE_3__]);\n([_app_js__WEBPACK_IMPORTED_MODULE_0__, _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__, _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_2__, _memory_database_js__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\r\n\r\n\r\n\r\n\r\n// project manager\r\nconst homePage = document.getElementById('homePage');\r\nconst createProjectsForm = document.getElementById('createProjects');\r\nconst newProjectBtn = document.getElementById('newProjectBtn');\r\nconst cancelCreateBtn = document.getElementById('cancelCreate');\r\nconst projectForm = document.getElementById('projectForm');\r\nconst projectsContainer = document.getElementById('projects');\r\nconst menu = document.getElementById('menu');\r\n\r\ncreateProjectsForm.style.display = 'none';\r\n\r\n\r\nclass Project {\r\n    constructor() {\r\n        this.#addEventListener();\r\n    }\r\n\r\n    #addEventListener() {\r\n        newProjectBtn.addEventListener('click', function () {\r\n            createProjectsForm.style.display = 'block';\r\n            document.getElementById('projectName').focus();\r\n        });\r\n\r\n        cancelCreateBtn.addEventListener('click', function () {\r\n            createProjectsForm.style.display = 'none';\r\n            projectForm.reset();\r\n        });\r\n\r\n\r\n        projectForm.addEventListener('submit', async (e) => {\r\n            e.preventDefault();\r\n\r\n            const projectName = document.getElementById('projectName').value;\r\n            const projectWidth = document.getElementById('projectWidth').value;\r\n            const projectHeight = document.getElementById('projectHeight').value;\r\n\r\n            const projectId = (0,uuid__WEBPACK_IMPORTED_MODULE_4__[\"default\"])();\r\n            const thumbnail = await _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createPreviewCanvas(_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createCanvas(projectWidth, projectHeight));\r\n            const url = URL.createObjectURL(thumbnail);\r\n            const newProject = this.createProjectElement(projectId, projectName, url);;\r\n\r\n            projectsContainer.appendChild(newProject);\r\n\r\n            createProjectsForm.style.display = 'none';\r\n            projectForm.reset();\r\n\r\n            await _memory_database_js__WEBPACK_IMPORTED_MODULE_3__.dbOperations.createProject({\r\n                id: projectId,\r\n                name: projectName,\r\n                width: projectWidth,\r\n                height: projectHeight,\r\n                thumbnail\r\n            });\r\n\r\n            URL.revokeObjectURL(url);\r\n            this.openProject(projectId, projectName);\r\n        });\r\n\r\n\r\n        // delete project\r\n        projectsContainer.addEventListener('click', async (e) => {\r\n            e.preventDefault();\r\n            if (e.target.closest('.delete')) {\r\n                const projectItem = e.target.closest('.project-item');\r\n                const projectName = projectItem.querySelector('.project-name').textContent;\r\n                const id = projectItem.dataset.projectId;\r\n\r\n                if (confirm(`Are you sure you want to delete \"${projectName}\"?`)) {\r\n                    await _memory_database_js__WEBPACK_IMPORTED_MODULE_3__.dbOperations.deleteProject(id);\r\n                    projectItem.remove();\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n        projectsContainer.addEventListener('click', (e) => {\r\n            if (!(e.target.closest('.delete') || e.target.closest('.project-name')) && e.target.closest('.project-item')) {\r\n                const projectItem = e.target.closest('.project-item');\r\n                const projectName = projectItem.querySelector('.project-name').textContent;\r\n\r\n                const projectId = projectItem.dataset.projectId;\r\n                this.openProject(projectId, projectName);\r\n            }\r\n        });\r\n\r\n        // Rename project\r\n        projectsContainer.addEventListener('blur', (e) => {\r\n            if (e.target.classList.contains('project-name')) {\r\n                const projectItem = e.target.closest('.project-item');\r\n                const projectId = projectItem.dataset.projectId;\r\n                const newName = e.target.textContent.trim();\r\n                if (newName === '') {\r\n                    e.target.textContent = 'Untitled Project';\r\n                }\r\n\r\n                _memory_database_js__WEBPACK_IMPORTED_MODULE_3__.dbOperations.updateProject(projectId, {\r\n                    name: e.target.textContent\r\n                });\r\n\r\n            }\r\n        }, true);\r\n\r\n\r\n        projectsContainer.addEventListener('keydown', (e) => {\r\n            if (e.target.classList.contains('project-name') && e.key === 'Enter') {\r\n                e.preventDefault();\r\n                e.target.blur();\r\n            }\r\n        });\r\n\r\n        menu.addEventListener('click', _ => { homePage.style.display = 'block'; _canvas_layer_manager_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].init(); });\r\n    }\r\n\r\n    async init() {\r\n        const currentProject = _memory_database_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].getCurrentProjectID();\r\n        if (currentProject) {\r\n            homePage.style.display = 'none';\r\n            const project = await _memory_database_js__WEBPACK_IMPORTED_MODULE_3__.dbOperations.getProject(currentProject);\r\n            if (project) {\r\n                this.openProject(project.id, project.name);\r\n            } else {\r\n                homePage.style.display = 'block';\r\n            }\r\n        }\r\n\r\n        // Load existing projects on startup\r\n        const projects = await _memory_database_js__WEBPACK_IMPORTED_MODULE_3__.dbOperations.getAllProjects();\r\n        projects.forEach(project => {\r\n            const url = URL.createObjectURL(project.thumbnail);\r\n            const projectElement = this.createProjectElement(project.id, project.name, url);\r\n            projectsContainer.appendChild(projectElement);\r\n            setTimeout(() => {\r\n                URL.revokeObjectURL(url);\r\n            }, 100)\r\n        })\r\n        _app_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].unloading = false;\r\n    }\r\n\r\n    createProjectElement(id, name, imgSrc) {\r\n        const projectDiv = document.createElement('div');\r\n        projectDiv.className = 'project-item';\r\n        projectDiv.dataset.projectId = id;\r\n\r\n        projectDiv.innerHTML = `\r\n            <button class=\"delete\" title=\"Delete Project\" aria-label=\"Delete Project\">\r\n                <img src=\"./images/icons/delete.svg\" alt=\"Delete\">\r\n            </button>\r\n            <div class=\"project-thumbnail\">\r\n                <img src=\"${imgSrc}\" style=\"background-color: white;\" alt=\"Project Thumbnail\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%;\">\r\n            </div>\r\n            <div class=\"project-name\" contenteditable=\"true\">${name}</div>\r\n        `;\r\n\r\n        return projectDiv;\r\n    }\r\n\r\n\r\n    async openProject(id, name) {\r\n        homePage.style.display = 'none';\r\n        localStorage.setItem('current-project', id);\r\n        await _app_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].init();\r\n    }\r\n}\r\n\r\nconst project = new Project();\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });\n\n//# sourceURL=webpack://quanvas/./scripts/core/projects.js?\n}");

/***/ }),

/***/ "./scripts/core/toolbox/manager.js":
/*!*****************************************!*\
  !*** ./scripts/core/toolbox/manager.js ***!
  \*****************************************/
/***/ ((__webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.a(__webpack_module__, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../shared/constants.js */ \"./scripts/shared/constants.js\");\n/* harmony import */ var _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../canvas/canvas.js */ \"./scripts/core/canvas/canvas.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__]);\nvar __webpack_async_dependencies_result__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n_canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_async_dependencies_result__[0];\n\r\n\r\n\r\nconst sideBarMenuElem = document.getElementById(\"tools\");\r\nconst toolsMenuElem = document.getElementById('toolsmenu');\r\n\r\nclass ToolBoxManager {\r\n    constructor() {\r\n        ('Tool Manager')\r\n        this.activeToolId = 'P-pen';\r\n        this.#addEventListener();\r\n    }\r\n\r\n    #addEventListener() {\r\n        sideBarMenuElem.addEventListener(\"click\", (e) => {\r\n            toolsMenuElem.style.visibility = 'hidden';\r\n            const tool = e.target;\r\n            if (!_shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.TOOLS_MENU[tool.id[0]]?.includes(tool.id)) return;\r\n            const prevM = toolsMenuElem.querySelector(`#${this.activeToolId[0]}`);\r\n            const newM = toolsMenuElem.querySelector(`#${tool.id[0]}`);\r\n            prevM.style.display = 'none';\r\n            newM.style.display = 'flex';\r\n            if (e.ctrlKey && _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.TOOLS_MENU[tool.id[0]].length > 1) {\r\n                const { top, right } = tool.getBoundingClientRect();\r\n                toolsMenuElem.style.top = top + 'px';\r\n                toolsMenuElem.style.left = (right + 10) + 'px';\r\n                toolsMenuElem.style.visibility = 'visible';\r\n            }\r\n            this.selectTool(tool.id);\r\n        });\r\n\r\n        toolsMenuElem.addEventListener('click', (e) => {\r\n            toolsMenuElem.style.visibility = 'hidden';\r\n            if (!_shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.TOOLS_MENU[e.target.id[0]]?.includes(e.target.id)) return;\r\n            this.selectTool(e.target.id);\r\n        })\r\n    }\r\n\r\n    selectTool(id) {\r\n        _canvas_canvas_js__WEBPACK_IMPORTED_MODULE_1__.canvas.releasePath();\r\n        let elem;\r\n        const toolsMenu = _shared_constants_js__WEBPACK_IMPORTED_MODULE_0__.TOOLS_MENU[id[0]];\r\n\r\n        for (let i = 0; i < toolsMenu.length; i++) {\r\n            if (toolsMenu[i] == id) {\r\n                elem = document.getElementById(id);\r\n                break;\r\n            };\r\n        }\r\n\r\n        sideBarMenuElem.querySelector(`#${this.activeToolId}`).classList.remove('selected');\r\n        let selectedElem = sideBarMenuElem.querySelector(`#${elem.id}`);\r\n        if (!selectedElem) {\r\n            selectedElem = sideBarMenuElem.querySelector(`[id^=${elem.id[0]}]`);\r\n            const tempSrc = elem.src;\r\n            const tempId = elem.id;\r\n            elem.src = selectedElem.src;\r\n            elem.id = selectedElem.id;\r\n            selectedElem.src = tempSrc;\r\n            selectedElem.id = tempId;\r\n            selectedElem.classList.add('selected');\r\n        } else {\r\n            selectedElem = elem;\r\n        }\r\n        selectedElem.classList.add('selected');\r\n\r\n        this.activeToolId = selectedElem.id;\r\n    }\r\n}\r\n\r\nconst toolsManager = new ToolBoxManager();\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (toolsManager);\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });\n\n//# sourceURL=webpack://quanvas/./scripts/core/toolbox/manager.js?\n}");

/***/ }),

/***/ "./scripts/shared/constants.js":
/*!*************************************!*\
  !*** ./scripts/shared/constants.js ***!
  \*************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CANVAS_PROP: () => (/* binding */ CANVAS_PROP),\n/* harmony export */   TOOLS_MENU: () => (/* binding */ TOOLS_MENU),\n/* harmony export */   TOOL_IDS: () => (/* binding */ TOOL_IDS)\n/* harmony export */ });\nconst TOOL_IDS = [\r\n    'pen', 'pen',\r\n    'rectangle', 'round-rectangle',\r\n    'circle', 'ellipse',\r\n    'line',\r\n    'quadratic', 'bezier',\r\n    'add-layer',\r\n    'clipboard',\r\n    'eraser', 'fillrule',\r\n    'nomove'\r\n];\r\n\r\nconst TOOLS_MENU = {\r\n    'P': ['P-pen', 'P-chalk'],\r\n    'R': ['R-rectangle', 'R-roundrectangle'],\r\n    'C': ['C-circle', 'C-ellipse'],\r\n    'L': ['L-line', 'L-arcto'],\r\n    'K': ['K-quadratic', 'K-bezier'],\r\n};\r\n\r\nconst CANVAS_PROP = {\r\n    width: 1920,\r\n    height: 1080,\r\n    scale: 1\r\n}\n\n//# sourceURL=webpack://quanvas/./scripts/shared/constants.js?\n}");

/***/ }),

/***/ "./scripts/shared/domElem.js":
/*!***********************************!*\
  !*** ./scripts/shared/domElem.js ***!
  \***********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   layersElem: () => (/* binding */ layersElem),\n/* harmony export */   rootControllerElem: () => (/* binding */ rootControllerElem),\n/* harmony export */   rootElem: () => (/* binding */ rootElem)\n/* harmony export */ });\nconst rootElem = document.getElementById('root');\r\nconst rootControllerElem = document.getElementById('controller');\r\nconst layersElem = document.getElementById('layers');\n\n//# sourceURL=webpack://quanvas/./scripts/shared/domElem.js?\n}");

/***/ }),

/***/ "./scripts/utils/random.js":
/*!*********************************!*\
  !*** ./scripts/utils/random.js ***!
  \*********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   random: () => (/* binding */ random)\n/* harmony export */ });\nfunction random(min, max) {\r\n    const minCeiled = Math.ceil(min);\r\n    const maxFloored = Math.floor(max);\r\n    return Math.floor(Math.random() * (maxFloored - minCeiled) + minCeiled);\r\n}\n\n//# sourceURL=webpack://quanvas/./scripts/utils/random.js?\n}");

/***/ }),

/***/ "./scripts/utils/vector.js":
/*!*********************************!*\
  !*** ./scripts/utils/vector.js ***!
  \*********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateNormal: () => (/* binding */ calculateNormal),\n/* harmony export */   calculateTangent: () => (/* binding */ calculateTangent),\n/* harmony export */   getNormal: () => (/* binding */ getNormal),\n/* harmony export */   lerp: () => (/* binding */ lerp)\n/* harmony export */ });\nfunction getNormal(c1, c2) {\r\n    const tangent = calculateTangent(c1, c2);\r\n    return calculateNormal(tangent);\r\n}\r\n\r\nfunction calculateTangent(a, b) {\r\n    const x = b.x - a.x;\r\n    const y = b.y - a.y;\r\n\r\n    const L = Math.hypot(x, y);\r\n\r\n    return {\r\n        x,\r\n        y,\r\n        L,\r\n        ux: x / L,\r\n        uy: y / L\r\n    }\r\n}\r\n\r\nfunction calculateNormal(tangent) {\r\n    const { x: Tx, y: Ty, ux: Tux, uy: Tuy } = tangent;\r\n\r\n    return {\r\n        x: -Ty,\r\n        y: Tx,\r\n        ux: -Tuy,\r\n        uy: Tux\r\n    }\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return a + (b - a) * t;\r\n}\r\n\n\n//# sourceURL=webpack://quanvas/./scripts/utils/vector.js?\n}");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/async module */
/******/ 	(() => {
/******/ 		var hasSymbol = typeof Symbol === "function";
/******/ 		var webpackQueues = hasSymbol ? Symbol("webpack queues") : "__webpack_queues__";
/******/ 		var webpackExports = hasSymbol ? Symbol("webpack exports") : "__webpack_exports__";
/******/ 		var webpackError = hasSymbol ? Symbol("webpack error") : "__webpack_error__";
/******/ 		
/******/ 		
/******/ 		var resolveQueue = (queue) => {
/******/ 			if(queue && queue.d < 1) {
/******/ 				queue.d = 1;
/******/ 				queue.forEach((fn) => (fn.r--));
/******/ 				queue.forEach((fn) => (fn.r-- ? fn.r++ : fn()));
/******/ 			}
/******/ 		}
/******/ 		var wrapDeps = (deps) => (deps.map((dep) => {
/******/ 			if(dep !== null && typeof dep === "object") {
/******/ 		
/******/ 				if(dep[webpackQueues]) return dep;
/******/ 				if(dep.then) {
/******/ 					var queue = [];
/******/ 					queue.d = 0;
/******/ 					dep.then((r) => {
/******/ 						obj[webpackExports] = r;
/******/ 						resolveQueue(queue);
/******/ 					}, (e) => {
/******/ 						obj[webpackError] = e;
/******/ 						resolveQueue(queue);
/******/ 					});
/******/ 					var obj = {};
/******/ 		
/******/ 					obj[webpackQueues] = (fn) => (fn(queue));
/******/ 					return obj;
/******/ 				}
/******/ 			}
/******/ 			var ret = {};
/******/ 			ret[webpackQueues] = x => {};
/******/ 			ret[webpackExports] = dep;
/******/ 			return ret;
/******/ 		}));
/******/ 		__webpack_require__.a = (module, body, hasAwait) => {
/******/ 			var queue;
/******/ 			hasAwait && ((queue = []).d = -1);
/******/ 			var depQueues = new Set();
/******/ 			var exports = module.exports;
/******/ 			var currentDeps;
/******/ 			var outerResolve;
/******/ 			var reject;
/******/ 			var promise = new Promise((resolve, rej) => {
/******/ 				reject = rej;
/******/ 				outerResolve = resolve;
/******/ 			});
/******/ 			promise[webpackExports] = exports;
/******/ 			promise[webpackQueues] = (fn) => (queue && fn(queue), depQueues.forEach(fn), promise["catch"](x => {}));
/******/ 			module.exports = promise;
/******/ 			var handle = (deps) => {
/******/ 				currentDeps = wrapDeps(deps);
/******/ 				var fn;
/******/ 				var getResult = () => (currentDeps.map((d) => {
/******/ 		
/******/ 					if(d[webpackError]) throw d[webpackError];
/******/ 					return d[webpackExports];
/******/ 				}))
/******/ 				var promise = new Promise((resolve) => {
/******/ 					fn = () => (resolve(getResult));
/******/ 					fn.r = 0;
/******/ 					var fnQueue = (q) => (q !== queue && !depQueues.has(q) && (depQueues.add(q), q && !q.d && (fn.r++, q.push(fn))));
/******/ 					currentDeps.map((dep) => (dep[webpackQueues](fnQueue)));
/******/ 				});
/******/ 				return fn.r ? promise : getResult();
/******/ 			}
/******/ 			var done = (err) => ((err ? reject(promise[webpackError] = err) : outerResolve(exports)), resolveQueue(queue))
/******/ 			body(handle, done);
/******/ 			queue && queue.d < 0 && (queue.d = 0);
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./main.js");
/******/ 	
/******/ })()
;